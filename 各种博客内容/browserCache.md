## 浏览器缓存头部

1. Cache-Control：具有最高优先级的缓存策略头部。服务端/客户端均可以使用。这个头部包含了各种各样的缓存信息。可以进行多重限制，但是客户端总是采取最保守的缓存验证策略。

* `public`：资源将会被客户端和代理服务器缓存。
* `private`：资源仅仅会被客户端缓存。
* `no-store`：请求和响应都不进行资源缓存，完全不进行缓存。
* `no-cache`：资源被缓存，但是立刻过期，同时下次访问的时候强制验证资源的有效性。也就是每次请求必须要进行验证，否则不能够使用缓存。
* `max-age`：缓存资源，但是在指定的时间之后过期。
* `s-maxage`：依赖`public`配置，并且只在缓存服务器上生效，覆盖`max-age`。
* `max-stale`：指定时间内，即使缓存过期，资源仍然有效。*宽松缓存条件*
* `min-fresh`：获取的资源至少要保持指定时间的新鲜期。*保守缓存条件*
* `must-revalidation/proxy-revalidation`：如果缓存失效，那么需要强制向服务器/代理发起验证。
* `only-if-cached`：仅仅返回已经缓存的资源，不进行网络访问，如果没有缓存则返回504（Gateway Timeout 网关超时）。
* `no-transform`：强制要求代理服务器不要对资源进行转换。禁止代理服务器对`Content-Type`,`Content-Range`,`Content-Encoding`等字段的修改。

2. Pragma

该字段为HTTP/1.0字段，通常设置为`Pragma: no-cache`，作用和`Cache-Control: no-cache`一致。也就是如果服务器不支持HTTP/1.1的时候使用该字段。

3. Expires

到期时间，以服务器时间作为参考。如果缓存到期，那么直接对服务器进行缓存验证，而不直接使用本地缓存。

4. Etag

实体标签，服务器资源的唯一标识符，浏览器可以根据ETag值缓存数据，如果资源改变Etag可以帮助防止同步更新资源的相互覆盖，ETag优先级高于`Last-Modified`。

5. If-Match

缓存校验字段，其值为上次收到的一个或者多个`ETag`值，常用于判断条件是否满足：

* 对于GET或者HEAD请求，结合Range首部字段，来保证新范围的请求和前一个来自于相同的源。

* 对于PUT或者其他不安全的请求，`If-Match`可用于阻止错误的更新操作。

6. If-None-Match

缓存校验字段，结合`ETag`字段，常用于判断缓存资源是否有效，优先级比`If-Modified-Since`高。

* 对于GET或者HEAD请求，如果其`ETag`列表均不匹配，服务器将返回200状态码的响应。反之，将返回304状态码的响应。

* 对于其他更新服务器资源的请求，如果`ETag`列表匹配，服务器将执行更新，反之，将返回412状态码的响应。

7. Last-Modified

用于标记请求资源的最后一次修改时间。`Last-Modified`是`ETag`的容错机制，优先级低于`ETag`，并且只能精确到秒，因此不太适合短时间内的频繁改动，服务器端的静态资源，通常需要编译打包，可能出现资源内容没有发生改变，而`Last-Modified`发生了改变。

8. If-Modified-Since

缓存校验字段，其值为上次响应头`Last-Modified`值，如果与请求资源当前的`Last-Modified`值相同，那么返回304状态码，否则返回200

9. If-Unmodified-Since

缓存校验字段，表示资源如果未修改，则执行正常更新。

## 强缓存

一旦资源命中强缓存，浏览器便不会向服务器发送请求，而是直接读取缓存。

对于常规请求，只要存在该资源的缓存，并且`Cache-Control: max-age`或者`Expires`没有过期，那么就可以命中强缓存。

## 协商缓存

缓存过期之后，继续请求资源：

* 根据上次响应中的`ETag`值，自动向请求头中添加`If-None-Match`字段，服务器收到请求之后，拿着该字段的值与请求资源的`ETag`进行比较，如果相同，则返回304。

* 根据上次响应的`Last-Modified`值，在请求头中添加`If-Modified-Since`字段，与资源的`Last-Modified`值进行比较，如果相同，则命中缓存，返回304。

`Age: 0`表示命中了代理服务器的缓存，不仅验证了资源的有效性，同时还更新了浏览器缓存。`age`值为0表示代理服务器刚刚刷新了一次缓存。

`Cache-Control: max-age=600`覆盖了`Expires`字段，表示10分钟后缓存过期。

## 缓存相关字段

* `Age`：出现这个字段，表示命中代理服务器缓存，它指的是代理服务器对于请求资源的已缓存时间。

* `Date`：指的是响应生成的时间。请求经过代理服务器的时候，返回的`Date`未必是最新的，通常这个时候，代理服务器将会增加一个`Age`字段告知该资源已经缓存了多久。

* `Vary`：对于服务器而言，资源文件可能不止一个版本，针对不同的客户端，通常需要返回不同的资源版本。服务器通过指定`Vary: Accept-Encoding, User-Agent`，来保证针对是否压缩和浏览器类型两个维度去缓存资源。

## 怎么让浏览器不缓存静态资源

在某些情况下需要避免浏览器缓存。可以使用请求头：`Cache-Control: no-cache, no-store, must-revalidate`，或者给请求的资源加入一个版本号，这样就可以自由控制什么时候加载最新的资源。